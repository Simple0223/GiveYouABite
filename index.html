<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ ä¸€å£åˆ†ç”œ</title>

    <style>
        body {
            background-image: url('èƒŒæ™¯.jpg');
            background-size: cover;
            background-position: bottom;
            background-repeat: no-repeat;
            background-attachment: fixed;
            font-family: "Noto Sans TC",sans-serif;
            padding: 40px 15px;
        }

        .section {
            max-width: 850px;
            margin: auto;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .total-box {
            font-size: 18px;
            font-weight: bold;
            line-height: 1.8;
        }
    </style>
</head>

<body>

    <div class="section text-center">
        <h1>âœ¨ ä¸€å£åˆ†ç”œ</h1>
        <p>ä»¥åš´é¸é£Ÿæèˆ‡ç´°è†©å·¥æ³•è£½ä½œç”œé»ã€‚</p>
    </div>

    <form id="orderForm"
          action="https://docs.google.com/forms/d/e/1FAIpQLSeddvVROwPivkCKsaZJ1pBOSqSxcptIsGFHtQweB9I88jDzKg/formResponse"
          method="post"
          target="hidden_iframe"
          onsubmit="return prepareSubmit();">

        <iframe name="hidden_iframe"
                style="display:none;"
                onload="submitted()"></iframe>

        <div class="section">
            <h3>ğŸ° ç”¢å“æ•¸é‡</h3>

            ææ‹‰ç±³è˜‡ NT$180
            <input type="number" id="tiramisu" value="0" min="0" onchange="calculate()"><br><br>

            å·´æ–¯å…‹åˆ‡ç‰‡ NT$140
            <input type="number" id="basque_slice" value="0" min="0" onchange="calculate()"><br><br>

            å·´æ–¯å…‹6å‹ NT$680
            <input type="number" id="basque_whole" value="0" min="0" onchange="calculate()"><br><br>

            æª¸æª¬åˆ‡ç‰‡ NT$140
            <input type="number" id="lemon_slice" value="0" min="0" onchange="calculate()"><br><br>

            æª¸æª¬æ•´æ¢ NT$720
            <input type="number" id="lemon_whole" value="0" min="0" onchange="calculate()">

        </div>

        <div class="section">
            <h3>ğŸšš å–è²¨è³‡è¨Š</h3>

            å–è²¨æ–¹å¼
            <select id="pickupMethod" onchange="calculate()" required>
                <option value="è‡ªå–">è‡ªå–</option>
                <option value="å†·è—å®…é…">å†·è—å®…é…</option>
            </select><br><br>

            å–è²¨æ—¥
            <input type="date" id="pickupDate" required><br><br>

            <div id="addressBlock" style="display:none;">
                å®…é…åœ°å€
                <input type="text" id="shippingAddress">
            </div>

        </div>

        <div class="section total-box">
            åŸåƒ¹ï¼šNT$ <span id="subtotal">0</span><br>
            æŠ˜æ‰£å¾Œï¼šNT$ <span id="discounted">0</span><br>
            é‹è²»ï¼šNT$ <span id="shipping">0</span><br>
            <strong>æ‡‰ä»˜ç¸½é¡ï¼šNT$ <span id="final">0</span></strong>
        </div>

        <div class="section">

            <h3>ğŸ“ è¨‚å–®è³‡è¨Š</h3>

            å§“å
            <input type="text" name="entry.1915730164" required><br><br>

            é›»è©±
            <input type="text" name="entry.1422224818" required><br><br>

            ä¿¡ç®±
            <input type="email" name="entry.1477996357" required><br><br>

            åŒ¯æ¬¾å¾Œäº”ç¢¼
            <input type="text" name="entry.801140470" required><br><br>

            <input type="hidden" name="entry.665904672" id="pickupInfoField">
            <input type="hidden" name="entry.1983505291" id="summaryField">
            <input type="hidden" name="entry.1066634627" id="subtotalField">
            <input type="hidden" name="entry.1764733801" id="discountField">
            <input type="hidden" name="entry.943674488" id="shippingField">
            <input type="hidden" name="entry.1636048135" id="finalField">

            <button type="submit">é€å‡ºè¨‚å–®</button>

        </div>
    </form>

    <script>

        let currentSubtotal = 0;
        let currentDiscounted = 0;
        let currentShipping = 0;
        let currentFinal = 0;
        let formSubmitted = false;

        function calculate() {

            let t = 180 * Number(tiramisu.value || 0);
            let b1 = 140 * Number(basque_slice.value || 0);
            let b2 = 680 * Number(basque_whole.value || 0);
            let l1 = 140 * Number(lemon_slice.value || 0);
            let l2 = 720 * Number(lemon_whole.value || 0);

            currentSubtotal = t + b1 + b2 + l1 + l2;

            currentDiscounted = currentSubtotal;

            let today = new Date();
            let deadline = new Date(today.getFullYear(), 2, 8);

            if (today <= deadline) {
                currentDiscounted = Math.floor(currentSubtotal * 0.9);
            }

            let method = pickupMethod.value;
            currentShipping = 0;

            if (method === "å†·è—å®…é…") {
                currentShipping = currentDiscounted >= 1000 ? 0 : 80;
                addressBlock.style.display = "block";
            } else {
                addressBlock.style.display = "none";
            }

            currentFinal = currentDiscounted + currentShipping;

            subtotal.innerText = currentSubtotal;
            discounted.innerText = currentDiscounted;
            shipping.innerText = currentShipping;
            final.innerText = currentFinal;

        }

        function prepareSubmit() {

            calculate();

            if (!pickupDate.value) {
                alert("è«‹é¸æ“‡å–è²¨æ—¥æœŸ");
                return false;
            }

            if (pickupMethod.value === "å†·è—å®…é…" && !shippingAddress.value.trim()) {
                alert("è«‹å¡«å¯«å®…é…åœ°å€");
                return false;
            }

            if (
                Number(tiramisu.value) === 0 &&
                Number(basque_slice.value) === 0 &&
                Number(basque_whole.value) === 0 &&
                Number(lemon_slice.value) === 0 &&
                Number(lemon_whole.value) === 0
            ) {
                alert("è«‹è‡³å°‘é¸æ“‡ä¸€é …å•†å“");
                return false;
            }

            pickupInfoField.value =
                pickupMethod.value === "è‡ªå–"
                    ? "è‡ªå–\nå–è²¨æ—¥æœŸï¼š" + pickupDate.value
                    : "å†·è—å®…é…\nå–è²¨æ—¥æœŸï¼š" + pickupDate.value + "\nå®…é…åœ°å€ï¼š" + shippingAddress.value;

            let summary = "";

            if (tiramisu.value > 0) summary += "ææ‹‰ç±³è˜‡ x" + tiramisu.value + "\n";
            if (basque_slice.value > 0) summary += "å·´æ–¯å…‹åˆ‡ç‰‡ x" + basque_slice.value + "\n";
            if (basque_whole.value > 0) summary += "å·´æ–¯å…‹6å‹ x" + basque_whole.value + "\n";
            if (lemon_slice.value > 0) summary += "æª¸æª¬åˆ‡ç‰‡ x" + lemon_slice.value + "\n";
            if (lemon_whole.value > 0) summary += "æª¸æª¬æ•´æ¢ x" + lemon_whole.value + "\n";

            summary += "\nè¨‚å–®ç¸½é¡ï¼š" + currentFinal;

            summaryField.value = summary;
            subtotalField.value = currentSubtotal;
            discountField.value = currentDiscounted;
            shippingField.value = currentShipping;
            finalField.value = currentFinal;

            formSubmitted = true;

            return true;
        }

        function submitted() {
            if (formSubmitted) {
                alert("è¨‚å–®å·²æˆåŠŸé€å‡ºï¼");
                document.getElementById("orderForm").reset();
                formSubmitted = false;
                calculate();
            }
        }

        calculate();

    </script>

</body>
</html>